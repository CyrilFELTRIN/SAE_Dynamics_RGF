@page
@model SAE_Dynamics_RGF.Pages.ProductsModel
@using Microsoft.AspNetCore.Http
@{ 
    ViewData["Title"] = "Produits";
}

<section class="py-5 py-lg-7 bg-body-tertiary pb-0">
    <div class="container">
        <div class="row align-items-center g-4">
            <div class="col-lg-8">
                <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 rounded-pill mb-3 d-inline-block"
                      data-lang-fr="Catalogue"
                      data-lang-en="Catalog">
                    Catalogue
                </span>
                <h1 class="display-5 fw-bold mb-3" data-lang-fr="Nos produits" data-lang-en="Our products">Nos produits</h1>
                <!--
                <p class="lead text-muted mb-0"
                   data-lang-fr="Explorez tous les produits synchronisés depuis Dynamics/Dataverse."
                   data-lang-en="Browse all products synced from Dynamics/Dataverse.">
                    Explorez tous les produits synchronisés depuis Dynamics/Dataverse.
                </p>
                -->
            </div>
            <!--
            <div class="col-lg-4 d-none d-lg-block">
                <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-start gap-3">
                            <div class="icon-badge bg-primary bg-opacity-10 text-primary">
                                <i class="fas fa-layer-group"></i>
                            </div>
                            <div>
                                <div class="fw-semibold" data-lang-fr="Tout le catalogue" data-lang-en="Full catalog">Tout le catalogue</div>
                                <div class="text-muted small" data-lang-fr="Filtrez par catégories" data-lang-en="Filter by categories">Filtrez par catégories</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            -->
        </div>
    </div>
</section>

<section class="py-5">
    <div class="container">
        <div class="row g-3 align-items-end mb-4">
            <div class="col-12 col-lg-6">
                <div class="product-toolbar-field">
                    <div class="product-toolbar-label" data-lang-fr="Rechercher" data-lang-en="Search">Rechercher</div>
                    <div class="product-toolbar-control">
                        <form id="searchForm" autocomplete="off" class="product-toolbar-search">
                            <span class="product-toolbar-icon" aria-hidden="true">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text"
                                   id="searchInput"
                                   class="product-toolbar-input"
                                   placeholder="Rechercher un produit..."
                                   data-lang-fr-placeholder="Rechercher un produit..."
                                   data-lang-en-placeholder="Search for a product..."
                                   list="productSuggestions"
                                   autocomplete="off">
                            <button type="button" id="clearSearch" class="product-toolbar-clear d-none" aria-label="Clear">
                                <i class="fas fa-times"></i>
                            </button>
                        </form>
                    </div>
                </div>
                <datalist id="productSuggestions">
                    @foreach (var p in Model.Products)
                    {
                        <option value="@p.Name"></option>
                    }
                </datalist>
            </div>

            @if (Model.ParentProducts?.Any() == true)
            {
                <div class="col-12 col-md-6 col-lg-3">
                    <div class="product-toolbar-field">
                        <div class="product-toolbar-label" data-lang-fr="Filtrer" data-lang-en="Filter">Filtrer</div>
                        <div class="product-toolbar-control">
                            <span class="product-toolbar-select-icon" aria-hidden="true">
                                <i class="fas fa-layer-group"></i>
                            </span>
                            <select id="parentFilter" class="product-toolbar-select">
                        <option value="" data-lang-fr="Toutes les catégories" data-lang-en="All categories">Toutes les catégories</option>
                        @foreach (var parent in Model.ParentProducts)
                        {
                            <option value="@parent.Name">@parent.Name</option>
                        }
                            </select>
                        </div>
                    </div>
                </div>
            }

            <div class="col-12 col-md-6 col-lg-3">
                <div class="product-toolbar-field">
                    <div class="product-toolbar-label" data-lang-fr="Trier" data-lang-en="Sort">Trier</div>
                    <div class="product-toolbar-control">
                        <span class="product-toolbar-select-icon" aria-hidden="true">
                            <i class="fas fa-sort"></i>
                        </span>
                        <select id="sortSelect" class="product-toolbar-select">
                    <option value="" data-lang-fr="Aucun tri" data-lang-en="No sorting">Aucun tri</option>
                    <option value="name-asc" data-lang-fr="Nom (A-Z)" data-lang-en="Name (A-Z)">Nom (A-Z)</option>
                    <option value="name-desc" data-lang-fr="Nom (Z-A)" data-lang-en="Name (Z-A)">Nom (Z-A)</option>
                    <option value="price-asc" data-lang-fr="Prix (croissant)" data-lang-en="Price (low to high)">Prix (croissant)</option>
                    <option value="price-desc" data-lang-fr="Prix (décroissant)" data-lang-en="Price (high to low)">Prix (décroissant)</option>
                    <option value="category-asc" data-lang-fr="Catégorie (A-Z)" data-lang-en="Category (A-Z)">Catégorie (A-Z)</option>
                    <option value="category-desc" data-lang-fr="Catégorie (Z-A)" data-lang-en="Category (Z-A)">Catégorie (Z-A)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        @if (Model.Products == null || !Model.Products.Any())
        {
            <div class="text-center py-5">
                <div class="mx-auto mb-3 d-flex align-items-center justify-content-center rounded-circle bg-primary bg-opacity-10 text-primary"
                     style="width: 64px; height: 64px;">
                    <i class="fas fa-box-open"></i>
                </div>
                <p class="text-muted mb-0" data-lang-fr="Aucun produit trouvé dans Dataverse." data-lang-en="No products found in Dataverse.">Aucun produit trouvé dans Dataverse.</p>
            </div>
        }
        else
        {
            <div class="row g-4" id="productsContainer">
                @foreach (var p in Model.Products)
                {
                    <div class="col-sm-6 col-lg-4 product-card" data-parent="@p.Category">
                        <a class="text-decoration-none" asp-page="/ProductDetail" asp-route-ProductNumber="@p.ProductNumber">
                            <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden">
                                <div class="ratio ratio-16x9 bg-body-tertiary">
                                    <img src="@p.ImageUrl" class="w-100 h-100" alt="@p.Name" style="object-fit: cover;" loading="lazy">
                                </div>
                                <div class="card-body p-4">
                                    <div class="d-flex align-items-start justify-content-between gap-2">
                                        <h3 class="h5 fw-bold mb-1">@p.Name</h3>
                                        <i class="fas fa-arrow-right text-muted"></i>
                                    </div>
                                    <div class="text-muted small mb-0">@p.Category</div>
                                    <div class="mt-2 fw-semibold product-price" data-price-eur="@(p.PriceEur?.ToString("F2", System.Globalization.CultureInfo.InvariantCulture) ?? "")" data-price-chf="@(p.PriceChf?.ToString("F2", System.Globalization.CultureInfo.InvariantCulture) ?? "")" style="display:none;"></div>
                                </div>
                            </div>
                        </a>
                    </div>
                }
            </div>
        }
    </div>
</section>
